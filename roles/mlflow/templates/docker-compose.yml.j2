---
# roles/mlflow/templates/docker-compose.yml.j2
version: '3'
services:
    web:
        restart: always
        build: ./mlflow
        image: mlflow_server
        container_name: mlflow_server
        ports:
            - "{{ mlflow_port }}:5000"
        environment:
            - MLFLOW_S3_ENDPOINT_URL={{ mlflow_s3_endpoint_url }}
            - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}
            - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}
        command: mlflow server --backend-store-uri mysql+pymysql://${MYSQL_USER}:${MYSQL_PASSWORD}@{{ mysql_host }}:{{ mysql_port }}/${MYSQL_DATABASE} --default-artifact-root s3://mlflow/ --host 0.0.0.0
